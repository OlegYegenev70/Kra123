import telebot
from telebot.types import ReplyKeyboardMarkup, KeyboardButton, InlineKeyboardMarkup, InlineKeyboardButton

# Токен бота (замените на свой)
TOKEN = "7939208946:AAFKIZzxN-Nn-s5K_yN0n3H4UXw3j7lhkY8"
bot = telebot.TeleBot(TOKEN)

# Номер карты для оплаты
CARD_NUMBER = "2202208198088933"

# Города с товарами
CITIES = ["Москва", "Санкт-Петербург", "Казань", "Хабаровск", "Владивосток", "Новосибирск", "Оренбург", "Ростов на Дону", "Тверь", "Тюмень", "Архангельск", "Воронеж", "Иркутск", "Красноярск", "Нижний Новгород", "Омск", "Пермь", "Томск", "Самара", "Саратов", "Уфа", "Челябинск", "Чита"]

# Товары по городам
PRODUCTS = {
    "Москва": {
        1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Санкт-Петербург": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Казань": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Хабаровск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Владивосток": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Новосибирск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Оренбург": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Ростов на Дону": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Тверь": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Тюмень": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Архангельск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Воронеж": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Иркутск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Нижний Новгород": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Омск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Пермь": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Томск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Самара": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Саратов": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Уфа": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Челябинск": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },
    "Чита": {
    1: {"name": "Бошки 3гр", "price": 6500},
        2: {"name": "Гашиш (ice)", "price": 6000},
        3: {"name": "Мефедрон мука 3гр", "price": 6000},
        4: {"name": "Мефедрон кристалл 3гр", "price": 8000},
        5: {"name": "Альфа (кристалл) 3гр", "price": 9000},
        6: {"name": "Кокаин (best)", "price": 15000},
        7: {"name": "Экстази 3шт", "price": 4000},
        8: {"name": "Лсд (220)", "price": 3000},
        9: {"name": "Меф мука (мини опт) 10гр", "price": 15000},
       10: {"name": "Меф кристалл (мини опт) 10гр", "price": 20000},
       11: {"name": "Альфа кристалл (мини опт) 10гр", "price": 25000},
       12: {"name": "Бошки (мини опт) 10гр", "price": 17000},
       13: {"name": "Гашиш (ice) (мини опт) 10гр", "price": 15000},
    },

}

# Вакансии
JOBS = {
    "Курьер": """🚴
    ‍♂️ Суть работы - «раскладка» позиций по выданному району.

▪️ Мы платим за загруженные адреса, вам не нужно ожидать продажи клада.
▪️ Оплата за выполненную работу день в день.
▪️ Премии и бонусы среди курьеров организуются еженедельно.
▪️ Конкурсы среди курьеров проводятся в конце каждого календарного месяца. 
▪️ Мы обладаем огромной библиотекой обучающих материалов. Обучение проводится сотрудниками со стажем работы более пяти лет.
▪️ Присутствует чат для курьеров, в котором вы сможете обмениваться опытом с другими сотрудниками.
Устройство исключительно по залогу от 3000₽. Для начала трудоустройства напишите свой город оператору.""",

    "🖼 Трафаретчик 🖼": """ 
    Суть работы - нанесение рисунка/наклейки на проходимые места, фотографирование граффити/стикера через приложение NoteCam.

▪️ Оплата от 110₽ за граффити.
▪️ Оплата от 50₽ за стикер. 
▪️ Выплата от 20 граффити / 50 стикеров.
▪️ Текст для граффити выдаст оператор.
▪️ Чек при покупке краски сохраняйте, мы компенсируем затраты на неё при получении первой ЗП.

Для начала трудоустройства напишите свой город оператору, получите более подробную информацию и купите баллон с краской."""
}
# Информация о доставке
DELIVERY_INFO = """🚚 Доставка:  

▪️ При покупке любого товара из каталога вы можете заказать доставку. 

▪️ Доставка полностью анонимная и бесконтактная. Для осуществлендоставки необходимо указать желаемый адрес и курьер оставит клад в радиусе 300м, после чего сообщит координаты дополнительно приложив подробные фото.

💸 Стоимость доставки:
▫️ Обычная — 2000 ₽
╚ Срок выполнения: от 4 до 12 часов
▫️ Ускоренная — 2800 ₽
╚ Срок выполнения: от 1 до 2 часов

▪️ При заказе от 10000 ₽ доставка за счет магазина.

▪️ В исключительных случаях может потребоваться залог."""

# Словарь для хранения данных пользователей (город и корзина)
user_data = {}


# * КНОПКИ *

# Главное меню
def main_menu():
    markup = ReplyKeyboardMarkup(resize_keyboard=True)
    markup.add(KeyboardButton("🛍 Каталог"), KeyboardButton("🛒 Корзина"))
    markup.add(KeyboardButton("💳 Оплата"), KeyboardButton("🚚 Доставка"))
    markup.add(KeyboardButton("👨‍💼 Вакансии"))
    return markup


# Кнопка "🔙 Назад"
def back_button(previous_menu):
    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton("🔙 Назад", callback_data=previous_menu))
    return markup


# Кнопки выбора города
def city_buttons():
    markup = InlineKeyboardMarkup()
    for city in CITIES:
        markup.add(InlineKeyboardButton(city, callback_data=f"city_{city}"))
    markup.add(InlineKeyboardButton("🔙 Назад", callback_data="back_to_menu"))
    return markup


# Кнопки выбора товара
def product_buttons(city):
    markup = InlineKeyboardMarkup()
    for product_id, product in PRODUCTS[city].items():
        markup.add(InlineKeyboardButton(
            f"{product['name']} - {product['price']} руб.", callback_data=f"add_{product_id}"
        ))
    markup.add(InlineKeyboardButton("🔙 Назад", callback_data="back_to_cities"))
    return markup


# Кнопки вакансий
def job_buttons():
    markup = InlineKeyboardMarkup()
    for job in JOBS:
        markup.add(InlineKeyboardButton(job, callback_data=f"job_{job}"))
    markup.add(InlineKeyboardButton("🔙 Назад", callback_data="back_to_menu"))
    return markup


# Кнопки корзины
def cart_buttons():
    markup = InlineKeyboardMarkup()
    markup.add(InlineKeyboardButton("🗑 Очистить корзину", callback_data="clear_cart"))
    markup.add(InlineKeyboardButton("💰 Оплатить", callback_data="pay"))
    markup.add(InlineKeyboardButton("🔙 Назад", callback_data="back_to_menu"))
    return markup


# * ОБРАБОТКА КОМАНД *

@bot.message_handler(commands=["start"])
def send_welcome(message):
    bot.send_message(
        message.chat.id, """⚡️ Добро пожаловать в магазин @lavkasa ⚡️

▪️ В нашем магазине в короткие сроки вы можете получить необходимый вам товар.
▪️ Мы работаем круглосуточно.
▪️ Всегда сверяйте юзернейм оператора. МЫ НИКОГДА НЕ НАПИШЕМ ПЕРВЫЕ.
▪️ Если ваш населённый пункт отсутствует в каталоге - обратитесь к оператору, мы поможем с оформлением предзаказа/доставки""", reply_markup=main_menu()
    )


@bot.message_handler(content_types=["text"])
def handle_buttons(message):
    user_id = message.chat.id

    if message.text == "🛍 Каталог":
        bot.send_message(user_id, "🌆 Выберите город:", reply_markup=city_buttons())

    elif message.text == "🛒 Корзина":
        show_cart(user_id)

    elif message.text == "💳 Оплата":
        bot.send_message(user_id, f"💳 Оплатите на карту: {CARD_NUMBER}\nПосле оплаты свяжитесь с менеджером и предоставьте чек: @lavkasa")

    elif message.text == "🚚 Доставка":
        bot.send_message(user_id, DELIVERY_INFO, parse_mode="Markdown", reply_markup=back_button("back_to_menu"))

    elif message.text == "👨‍💼 Вакансии":
        bot.send_message(user_id, "📋 Доступные вакансии:", reply_markup=job_buttons())


# * ОБРАБОТКА INLINE-КНОПОК *

@bot.callback_query_handler(func=lambda call: True)
def handle_callback(call):
    user_id = call.message.chat.id

    if call.data.startswith("city_"):
        city = call.data.split("_")[1]
        user_data[user_id] = {"city": city, "cart": []}
        bot.edit_message_text(f"🏙 Город: {city}\n\nВыберите товар:", user_id, call.message.message_id,
                              reply_markup=product_buttons(city))

    elif call.data.startswith("add_"):
        product_id = int(call.data.split("_")[1])
        city = user_data[user_id]["city"]
        user_data[user_id]["cart"].append(PRODUCTS[city][product_id])
        bot.answer_callback_query(call.id, f"✅ {PRODUCTS[city][product_id]['name']} добавлен в корзину!")

    elif call.data == "clear_cart":
        user_data[user_id]["cart"] = []
        bot.edit_message_text("🛒 Корзина очищена!", user_id, call.message.message_id, reply_markup=cart_buttons())

    elif call.data == "pay":
        bot.send_message(user_id, f"💳 Оплатите на карту: {CARD_NUMBER}\nПосле оплаты свяжитесь с менеджером и предоставьте чек: @lavkasa",
                         reply_markup=back_button("back_to_menu"))

    elif call.data.startswith("job_"):
        job = call.data.split("_")[1]
        bot.send_message(user_id, f"📌 {job}:\n{JOBS[job]}", reply_markup=back_button("back_to_menu"))

    elif call.data == "back_to_menu":
        bot.edit_message_text("👋 Добро пожаловать в магазин! Выберите действие:", user_id, call.message.message_id,
                              reply_markup=main_menu())

    elif call.data == "back_to_cities":
        bot.edit_message_text("🌆 Выберите город:", user_id, call.message.message_id, reply_markup=city_buttons())


# * ПРОСМОТР КОРЗИНЫ *

def show_cart(user_id):
    if user_id not in user_data or not user_data[user_id]["cart"]:
        bot.send_message(user_id, "🛒 Ваша корзина пуста.", reply_markup=back_button("back_to_menu"))
        return

    text = "🛒 Ваша корзина:\n"
    total_price = sum(item["price"] for item in user_data[user_id]["cart"])
    text += "\n".join([f"{i+1}. {item['name']} - {item['price']} руб." for i, item in enumerate(user_data[user_id]["cart"])])
    text += f"\n\n💰 Общая сумма: {total_price} руб."
    bot.send_message(user_id, text, reply_markup=cart_buttons())


bot.polling(none_stop=True)